!function(){"use strict";class e{constructor(e,t,n,s,r,o){this.name=e.name,this.link=e.link,this._likes=e.likes,this._id=e._id,this._owner=e.owner,this._currentUserId=o,this.templateSelector=t,this._handleCardClick=n,this._handleCardLike=r,this._handleCardDelete=s}getId(){return this._id}_setMarkup(){this._cardImage=this._cardElement.querySelector(".card__image"),this._cardImage.src=this.link,this._cardImage.alt=this.name,this._cardElement.querySelector(".card__bottom-text").textContent=this.name}_renderLikes(){this._likeCount.textContent=this._likes.length,this.isLikedByUser()?this._likeButton.classList.add("card__bottom-button_clicked"):this._likeButton.classList.remove("card__bottom-button_clicked")}setLikes(e){this._likes=e,this._renderLikes()}_getTemplateClone(){return document.querySelector(this.templateSelector).content.querySelector(".card").cloneNode(!0)}isLikedByUser(){return this._likes.some((e=>e._id===this._currentUserId))}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleCardLike(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleCardDelete(this)})),this._cardElement.querySelector(".card__image").addEventListener("click",(()=>{this._handleCardClick(this)}))}deleteCard(){this._cardElement.remove(),this._cardElement=null}generateCard(){return this._cardElement=this._getTemplateClone(),this._deleteButton=this._cardElement.querySelector(".card__delete"),this._likeCount=this._cardElement.querySelector(".card__bottom-count"),this._likeButton=this._cardElement.querySelector(".card__bottom-button"),this._currentUserId!==this._owner._id&&this._deleteButton.remove(),this._setMarkup(),this._setEventListeners(),this._renderLikes(),this._cardElement}}class t{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._formElement.querySelector(this._settings.submitButtonSelector)}enableValidation(){this._setEventListeners()}_setEventListeners(){this._formElement.addEventListener("reset",(()=>{this.resetValidation()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputError(e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}_toggleInputError(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_showInputError(e,t){const n=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),n.textContent=t,n.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_enableButton(){this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._settings.inactiveButtonClass)}_disableButton(){this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._settings.inactiveButtonClass)}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this._disableButton():this._enableButton()}resetValidation(){this._disableButton(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s{constructor(e){n(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.closePopup()})),n(this,"_handleClickClose",(e=>{e.target===e.currentTarget&&this.closePopup()})),this._popupElement=e,this._popupExit=this._popupElement.querySelector(".modal__container-exit")}openPopup(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose),this._popupElement.addEventListener("mousedown",this._handleClickClose)}closePopup(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose),this._popupElement.removeEventListener("mousedown",this._handleClickClose)}setEventListeners(){this._popupExit.addEventListener("click",(e=>{this.closePopup()}))}}class r extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._formElement=this._popupElement.querySelector(".form"),this._inputList=this._formElement.querySelectorAll(".form__input"),this._buttonTextContainer=this._formElement.querySelector(".form__save"),this._defaultButtonText=this._buttonTextContainer.textContent}setLoadingText(e){this._buttonTextContainer.textContent=e?"Saving...":this._defaultButtonText}_getInputValues(){const e={};return this._inputList.forEach((t=>e[t.name]=t.value)),e}setEventListeners(){this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())})),super.setEventListeners()}openPopup(){this._formElement.reset(),super.openPopup()}}class o{constructor(e,t){let{data:n,renderer:s}=e;this._items=n,this._renderer=s,this._container=document.querySelector(t)}renderItems(){this._items.forEach(this._renderer)}addItem(e){this._container.prepend(e)}}document.querySelector(".elements__grid");const i=document.querySelector("#name-input"),a=document.querySelector("#description-input"),l=(document.querySelector(".profile__info-name").textContent,document.querySelector(".profile__info-description").textContent,document.querySelector("#title-input")),c=document.querySelector("#link-input"),d=document.querySelector("#addCard"),u=document.querySelector(".profile__edit"),h=document.querySelector(".profile__add"),_=document.querySelector("#edit"),p=(_.querySelector(".form"),d.querySelector(".form")),m=(document.querySelectorAll(".modal__container-exit"),p.querySelector("button"),document.querySelector("#editAvatar")),E=m.querySelector("#avatar-link-input"),f=(document.querySelector(".profile__image-avatar"),document.querySelector("#editAvatarButton")),v=document.querySelector("#pictureModal"),C=document.querySelector("#deleteCardModal"),g={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},S=Array.from(document.querySelectorAll(g.formSelector));let L=null;const y=new class{constructor(e){let{nameSelector:t,descriptionSelector:n,avatarSelector:s}=e;this._nameContainer=document.querySelector(t),this._descriptionContainer=document.querySelector(n),this._avatarContainer=document.querySelector(s)}getUserInfo(){return{name:this._nameContainer.textContent,about:this._descriptionContainer.textContent,avatar:this._avatarContainer.src}}setUserInfo(e){let{name:t,about:n}=e;this._nameContainer.textContent=t,this._descriptionContainer.textContent=n}getUserAvatar(){return this._avatarContainer.src}setUserAvatar(e){this._avatarContainer.src=e}}({nameSelector:".profile__info-name",descriptionSelector:".profile__info-description",avatarSelector:".profile__image-avatar"}),b=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._handleResponse)}getUserData(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._handleResponse)}updateUserInfo(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}updateProfilePicture(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}addNewCard(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._handleResponse)}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(this._handleResponse)}unlikeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"dfa974a3-627e-4477-8e0f-f2d5983e285f","Content-Type":"application/json"}});let k;Promise.all([b.getUserData(),b.getInitialCards()]).then((e=>{let[t,n]=e;y.setUserInfo(t),y.setUserAvatar(t.avatar),L=t._id,k=new o({data:n,renderer:q},".elements__grid"),k.renderItems()})).catch((e=>{console.log(e)}));const q=t=>{const n=new e(t,"#card-template",w,(()=>{T.openPopup((()=>{T.setLoadingText(!0),b.deleteCard(n.getId()).then((()=>{n.deleteCard(),T.closePopup()})).catch((e=>{console.log(e)})).finally((()=>{T.setLoadingText(!1)}))}))}),B,L),s=n.generateCard();k.addItem(s)},x=new r(d,(function(){const e={name:l.value,link:c.value};x.setLoadingText(!0),b.addNewCard(e).then((e=>{q(e),x.closePopup()})).catch((e=>{console.log(e)})).finally((()=>{x.setLoadingText(!1)}))}));x.setEventListeners();const I=new r(_,(function(){const e={name:i.value,about:a.value};I.setLoadingText(!0),b.updateUserInfo(e).then((e=>{y.setUserInfo(e),I.closePopup()})).catch((e=>{console.log(e)})).finally((()=>{I.setLoadingText(!1)}))}));I.setEventListeners();const P=new r(m,(function(){const e={avatar:E.value};P.setLoadingText(!0),b.updateProfilePicture(e).then((e=>{y.setUserAvatar(e.avatar),P.closePopup()})).catch((e=>{console.log(e)})).finally((()=>{P.setLoadingText(!1)}))}));P.setEventListeners();const T=new class extends s{constructor(e){super(e),this._formElement=this._popupElement.querySelector(".form"),this._buttonTextContainer=this._formElement.querySelector(".form__save"),this._defaultButtonText=this._buttonTextContainer.textContent}setLoadingText(e){this._buttonTextContainer.textContent=e?"Deleting...":this._defaultButtonText}openPopup(e){this._handleFormSubmit=e,super.openPopup()}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}}(C,(function(){b.deleteCard(card.getId()).then((()=>{card.deleteCard()})).catch((e=>{console.log(e)})),T.closePopup()}));T.setEventListeners();const U=new class extends s{constructor(e){super(e),this._popupImage=this._popupElement.querySelector(".modal__picture-image"),this._popupText=this._popupElement.querySelector(".modal__picture-text")}openPopup(e){this._popupImage.src=e.link,this._popupImage.alt=e.name,this._popupText.textContent=e.name,super.openPopup()}}(v);function B(e){e.isLikedByUser()?b.unlikeCard(e.getId()).then((t=>e.setLikes(t.likes))).catch((e=>console.log(e))):b.likeCard(e.getId()).then((t=>e.setLikes(t.likes))).catch((e=>console.log(e)))}function w(e){U.openPopup(e)}U.setEventListeners(),u.addEventListener("click",(function(){const e=y.getUserInfo();i.value=e.name,a.value=e.about,I.openPopup()})),h.addEventListener("click",(function(){x.openPopup()})),f.addEventListener("click",(function(){P.openPopup()})),S.forEach((e=>{!function(e,n){new t(e,n).enableValidation()}(g,e)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUk0QixTQUFTRixFQUFLMUosU0FDZitJLE1BQU1qSyxHQUFTNEssRUFBSzFJLFNBQVNsQyxFQUFLVSxTQUNsQzRLLE9BQU9DLEdBQVFDLFFBQVFDLElBQUlGLElBT2pDLENBRUQsU0FBU3JMLEVBQWdCMEssR0FDdkJ3QixFQUFXNUcsVUFBVW9GLEVBQ3RCLENBakJEd0IsRUFBV3hHLG9CQW9IWDhCLEVBQVdoRixpQkFBaUIsU0F2RjVCLFdBQ0UsTUFBTTZKLEVBQVVsRSxFQUFLTyxjQUNyQnZCLEVBQVViLE1BQVErRixFQUFRaE0sS0FDMUIrRyxFQUFpQmQsTUFBUStGLEVBQVExRCxNQUNqQ21ELEVBQVN4RyxXQUNWLElBbUZEbUMsRUFBVWpGLGlCQUFpQixTQWpGM0IsV0FDRW9KLEVBQVF0RyxXQUNULElBZ0ZEd0MsRUFBYXRGLGlCQUFpQixTQTlFOUIsV0FDRXdKLEVBQVcxRyxXQUNaLElBK0VENEMsRUFBU3hFLFNBQVNaLEtBakdsQixTQUF1QkQsRUFBVUMsR0FDTCxJQUFJRixFQUFjQyxFQUFVQyxHQUNwQ1Usa0JBQ25CLENBK0ZDOEksQ0FBY3pKLEVBQVVDLEVBQXhCLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IoZGF0YSwgdGVtcGxhdGVTZWxlY3RvciwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVDYXJkRGVsZXRlLCBoYW5kbGVDYXJkTGlrZSwgY3VycmVudFVzZXJJZCkge1xyXG4gICAgICB0aGlzLm5hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHRoaXMubGluayA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xyXG4gICAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXI7XHJcbiAgICAgIHRoaXMuX2N1cnJlbnRVc2VySWQgPSBjdXJyZW50VXNlcklkO1xyXG4gICAgICB0aGlzLnRlbXBsYXRlU2VsZWN0b3IgPSB0ZW1wbGF0ZVNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRMaWtlID0gaGFuZGxlQ2FyZExpa2U7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUgPSBoYW5kbGVDYXJkRGVsZXRlO1xyXG5cclxuICAgIH1cclxuICBcclxuICAgIGdldElkKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5faWQ7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldE1hcmt1cCgpIHtcclxuICAgICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMubGluaztcclxuICAgICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IHRoaXMubmFtZTtcclxuICAgICAgY29uc3QgY2FyZFRleHQgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2JvdHRvbS10ZXh0XCIpO1xyXG4gICAgICBjYXJkVGV4dC50ZXh0Q29udGVudCA9IHRoaXMubmFtZTtcclxuICAgIH1cclxuICBcclxuICAgIF9yZW5kZXJMaWtlcygpIHtcclxuICAgICAgdGhpcy5fbGlrZUNvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICBpZiAodGhpcy5pc0xpa2VkQnlVc2VyKCkpIHtcclxuICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19ib3R0b20tYnV0dG9uX2NsaWNrZWRcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fYm90dG9tLWJ1dHRvbl9jbGlja2VkXCIpO1xyXG4gICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2V0TGlrZXMobGlrZXMpIHtcclxuICAgICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfZ2V0VGVtcGxhdGVDbG9uZSgpIHtcclxuICAgICAgY29uc3QgY2xvbmVFbGVtZW50ID0gZG9jdW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLnRlbXBsYXRlU2VsZWN0b3IpXHJcbiAgICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgcmV0dXJuIGNsb25lRWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIGlzTGlrZWRCeVVzZXIoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b25cclxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMuX2hhbmRsZUNhcmRMaWtlKHRoaXMpO1xyXG4gICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICB0aGlzLl9kZWxldGVCdXR0b25cclxuICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlKHRoaXMpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIFxyXG5cclxuICAgICAgdGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKVxyXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHRoaXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQoKSB7XHJcbiAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGVDbG9uZSgpO1xyXG4gICAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZVwiKTtcclxuICAgICAgdGhpcy5fbGlrZUNvdW50ID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19ib3R0b20tY291bnRcIik7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2JvdHRvbS1idXR0b25cIik7XHJcbiAgICAgIGlmICh0aGlzLl9jdXJyZW50VXNlcklkICE9PSB0aGlzLl9vd25lci5faWQpIHtcclxuICAgICAgICB0aGlzLl9kZWxldGVCdXR0b24ucmVtb3ZlKCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fc2V0TWFya3VwKCk7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcclxuICAgIH1cclxuICB9XHJcbiAgIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl90b2dnbGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSh0aGlzLl9pbnB1dExpc3QsIHRoaXMuX2J1dHRvbkVsZW1lbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICBcclxuICAgIF90b2dnbGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICAgKTtcclxuICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcclxuICAgIH1cclxuICBcclxuICAgIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICAgKTtcclxuICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFzSW52YWxpZElucHV0KCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBfZW5hYmxlQnV0dG9uKCkge1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2Rpc2FibGVCdXR0b24oKSB7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcclxuICAgICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xyXG4gICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcHVwRWxlbWVudCkge1xyXG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBwb3B1cEVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuX3BvcHVwRXhpdCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIFwiLm1vZGFsX19jb250YWluZXItZXhpdFwiXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBvcGVuUG9wdXAoKSB7XHJcbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2UpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgY2xvc2VQb3B1cCgpIHtcclxuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlQ2xpY2tDbG9zZSk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PiB7XHJcbiAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgXHJcbiAgICBfaGFuZGxlQ2xpY2tDbG9zZSA9IChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQgPT09IGV2dC5jdXJyZW50VGFyZ2V0KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgdGhpcy5fcG9wdXBFeGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBFbGVtZW50LCBoYW5kbGVGb3JtU3VibWl0KSB7XHJcbiAgICBzdXBlcihwb3B1cEVsZW1lbnQpO1xyXG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX2lucHV0XCIpO1xyXG4gICAgdGhpcy5fYnV0dG9uVGV4dENvbnRhaW5lciA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fc2F2ZVwiKTtcclxuICAgIHRoaXMuX2RlZmF1bHRCdXR0b25UZXh0ID0gdGhpcy5fYnV0dG9uVGV4dENvbnRhaW5lci50ZXh0Q29udGVudDtcclxuICB9XHJcblxyXG4gIHNldExvYWRpbmdUZXh0KGlzTG9hZGluZykge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICAgIHRoaXMuX2J1dHRvblRleHRDb250YWluZXIudGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiOyBcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uVGV4dENvbnRhaW5lci50ZXh0Q29udGVudCA9IHRoaXMuX2RlZmF1bHRCdXR0b25UZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBmb3JtVmFsdWVzID0ge307XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IChmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWUpKTtcclxuXHJcbiAgICByZXR1cm4gZm9ybVZhbHVlcztcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIG9wZW5Qb3B1cCgpIHtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICBzdXBlci5vcGVuUG9wdXAoKTtcclxuICB9XHJcbiAgXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgZGF0YSwgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgICAgdGhpcy5faXRlbXMgPSBkYXRhO1xyXG4gICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuICBcclxuICAgIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKHRoaXMuX3JlbmRlcmVyKTtcclxuICAgIH1cclxuICBcclxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICAgIH1cclxuICB9IiwiY29uc3QgY2FyZFRlbXBsYXRlID0gXCIjY2FyZC10ZW1wbGF0ZVwiO1xyXG5jb25zdCBlbGVtZW50c0dyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19ncmlkXCIpO1xyXG5jb25zdCBncmlkU2VsZWN0b3IgPSBcIi5lbGVtZW50c19fZ3JpZFwiO1xyXG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWUtaW5wdXRcIik7XHJcbmNvbnN0IGRlc2NyaXB0aW9uSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Rlc2NyaXB0aW9uLWlucHV0XCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW5mby1uYW1lXCIpLnRleHRDb250ZW50O1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2luZm8tZGVzY3JpcHRpb25cIikudGV4dENvbnRlbnQ7XHJcbmNvbnN0IHRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpdGxlLWlucHV0XCIpO1xyXG5jb25zdCBsaW5rSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpbmstaW5wdXRcIik7XHJcbmNvbnN0IGFkZENhcmRXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZENhcmRcIik7XHJcbmNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXRcIik7XHJcbmNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkXCIpO1xyXG5jb25zdCBlZGl0V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0XCIpO1xyXG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBlZGl0V2luZG93LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKTtcclxuY29uc3QgYWRkRm9ybUVsZW1lbnQgPSBhZGRDYXJkV2luZG93LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKTtcclxuY29uc3QgZXhpdEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jb250YWluZXItZXhpdFwiKTtcclxuY29uc3Qgc2F2ZUJ1dHRvbkFkZCA9IGFkZEZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b25cIik7XHJcbmNvbnN0IGF2YXRhcldpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdEF2YXRhclwiKTtcclxuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJXaW5kb3cucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbGluay1pbnB1dFwiKTtcclxuY29uc3QgYXZhdGFyUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2UtYXZhdGFyXCIpO1xyXG5jb25zdCBhdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXRBdmF0YXJCdXR0b25cIik7XHJcbmNvbnN0IHBpY3R1cmVXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BpY3R1cmVNb2RhbFwiKTtcclxuY29uc3QgZGVsZXRlV2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGVDYXJkTW9kYWxcIik7XHJcbmNvbnN0IHVzZXJTZWxlY3RvciA9IHtuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2luZm8tbmFtZVwiLCBkZXNjcmlwdGlvblNlbGVjdG9yOiBcIi5wcm9maWxlX19pbmZvLWRlc2NyaXB0aW9uXCIsIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZS1hdmF0YXJcIn07XHJcblxyXG5jb25zdCBzZXR0aW5ncyA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIuZm9ybVwiLCBcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLmZvcm1fX2lucHV0XCIsIFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmZvcm1fX3NhdmVcIiwgXHJcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImZvcm1fX3NhdmVfZGlzYWJsZWRcIiwgXHJcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXRfdHlwZV9lcnJvclwiLCBcclxuICAgIGVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXQtZXJyb3JfYWN0aXZlXCJcclxufVxyXG5jb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5mb3JtU2VsZWN0b3IpKTtcclxuXHJcbmV4cG9ydCB7Y2FyZFRlbXBsYXRlLCBcclxuICAgIGVsZW1lbnRzR3JpZCxcclxuICAgIGdyaWRTZWxlY3RvciwgXHJcbiAgICBuYW1lSW5wdXQsIFxyXG4gICAgZGVzY3JpcHRpb25JbnB1dCwgXHJcbiAgICBwcm9maWxlTmFtZSwgXHJcbiAgICBwcm9maWxlRGVzY3JpcHRpb24sIFxyXG4gICAgdGl0bGVJbnB1dCwgXHJcbiAgICBsaW5rSW5wdXQsIFxyXG4gICAgYWRkQ2FyZFdpbmRvdywgXHJcbiAgICBlZGl0QnV0dG9uLCBcclxuICAgIGFkZEJ1dHRvbiwgXHJcbiAgICBlZGl0V2luZG93LCBcclxuICAgIGVkaXRGb3JtRWxlbWVudCwgXHJcbiAgICBhZGRGb3JtRWxlbWVudCwgXHJcbiAgICBleGl0QnV0dG9ucywgXHJcbiAgICBzYXZlQnV0dG9uQWRkLFxyXG4gICAgYXZhdGFyV2luZG93LFxyXG4gICAgYXZhdGFySW5wdXQsXHJcbiAgICBhdmF0YXJQaWN0dXJlLFxyXG4gICAgYXZhdGFyQnV0dG9uLFxyXG4gICAgcGljdHVyZVdpbmRvdyxcclxuICAgIGRlbGV0ZVdpbmRvdyxcclxuICAgIHVzZXJTZWxlY3RvciwgICBcclxuICAgIHNldHRpbmdzLCBcclxuICAgIGZvcm1MaXN0LCBcclxufTsiLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcclxuaW1wb3J0IHtcclxuICBjYXJkVGVtcGxhdGUsXHJcbiAgZ3JpZFNlbGVjdG9yLFxyXG4gIG5hbWVJbnB1dCxcclxuICBkZXNjcmlwdGlvbklucHV0LFxyXG4gIHRpdGxlSW5wdXQsXHJcbiAgbGlua0lucHV0LFxyXG4gIGFkZENhcmRXaW5kb3csXHJcbiAgZWRpdEJ1dHRvbixcclxuICBhZGRCdXR0b24sXHJcbiAgZWRpdFdpbmRvdyxcclxuICBwaWN0dXJlV2luZG93LFxyXG4gIHVzZXJTZWxlY3RvcixcclxuICBzZXR0aW5ncyxcclxuICBmb3JtTGlzdCxcclxuICBhdmF0YXJJbnB1dCxcclxuICBhdmF0YXJQaWN0dXJlLFxyXG4gIGF2YXRhcldpbmRvdyxcclxuICBhdmF0YXJCdXR0b24sICBcclxuICBkZWxldGVXaW5kb3dcclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5sZXQgY3VycmVudFVzZXJJZCA9IG51bGw7XHJcblxyXG5jb25zdCB1c2VyID0gbmV3IFVzZXJJbmZvKHVzZXJTZWxlY3Rvcik7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpICh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCJkZmE5NzRhMy02MjdlLTQ0NzctOGUwZi1mMmQ1OTgzZTI4NWZcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgfVxyXG59KTtcclxuXHJcbmxldCBjYXJkU2VjdGlvbjtcclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckRhdGEoKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigoW3VzZXJJbmZvUmVzLCBjYXJkUmVzXSkgPT4ge1xyXG4gICAgdXNlci5zZXRVc2VySW5mbyh1c2VySW5mb1Jlcyk7XHJcbiAgICB1c2VyLnNldFVzZXJBdmF0YXIodXNlckluZm9SZXMuYXZhdGFyKTtcclxuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VySW5mb1Jlcy5faWQ7XHJcblxyXG4gICAgY2FyZFNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICAgICAge1xyXG4gICAgICAgIGRhdGE6IGNhcmRSZXMsXHJcbiAgICAgICAgcmVuZGVyZXI6IHJlbmRlckNhcmQsXHJcbiAgICAgIH0sXHJcbiAgICAgIGdyaWRTZWxlY3RvclxyXG4gICAgKTtcclxuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XHJcbiAgfSlcclxuICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coZXJyKTtcclxuICB9KTtcclxuXHJcbmNvbnN0IHJlbmRlckNhcmQgPSAoY2FyZEl0ZW0pID0+IHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICBjYXJkSXRlbSwgXHJcbiAgICBjYXJkVGVtcGxhdGUsIFxyXG4gICAgaGFuZGxlQ2FyZENsaWNrLCBcclxuICAgICgpID0+IHtcclxuICAgICAgZGVsZXRlRm9ybS5vcGVuUG9wdXAoKCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZUZvcm0uc2V0TG9hZGluZ1RleHQodHJ1ZSk7XHJcbiAgICAgICAgYXBpLmRlbGV0ZUNhcmQoY2FyZC5nZXRJZCgpKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLmRlbGV0ZUNhcmQoKTtcclxuICAgICAgICAgICAgZGVsZXRlRm9ybS5jbG9zZVBvcHVwKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBkZWxldGVGb3JtLnNldExvYWRpbmdUZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0sIFxyXG4gICAgaGFuZGxlQ2FyZExpa2UsIFxyXG4gICAgY3VycmVudFVzZXJJZCk7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG5cclxuICBjYXJkU2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxufTtcclxuXHJcbmNvbnN0IGFkZEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShhZGRDYXJkV2luZG93LCBoYW5kbGVBZGRGb3JtU3VibWl0KTtcclxuYWRkRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgZWRpdEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShlZGl0V2luZG93LCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XHJcbmVkaXRGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBhdmF0YXJGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oYXZhdGFyV2luZG93LCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcclxuYXZhdGFyRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgZGVsZXRlRm9ybSA9IG5ldyBQb3B1cFdpdGhDb25maXJtKGRlbGV0ZVdpbmRvdywgaGFuZGxlRGVsZXRlRm9ybVN1Ym1pdCk7XHJcbmRlbGV0ZUZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGltYWdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UocGljdHVyZVdpbmRvdyk7XHJcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRMaWtlKGNhcmQpIHtcclxuICBpZighY2FyZC5pc0xpa2VkQnlVc2VyKCkpIHtcclxuICAgIGFwaS5saWtlQ2FyZChjYXJkLmdldElkKCkpXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiBjYXJkLnNldExpa2VzKGRhdGEubGlrZXMpKVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFwaS51bmxpa2VDYXJkKGNhcmQuZ2V0SWQoKSlcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IGNhcmQuc2V0TGlrZXMoZGF0YS5saWtlcykpXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICB9XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkQ2xpY2soY2FyZCkge1xyXG4gIGltYWdlUG9wdXAub3BlblBvcHVwKGNhcmQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkRGVsZXRlKCkge1xyXG4gIGRlbGV0ZUZvcm0ub3BlblBvcHVwKGhhbmRsZURlbGV0ZUZvcm1TdWJtaXQpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gYWRkVmFsaWRhdGlvbihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICBjb25zdCB2YWxpZGF0aW9uRWxlbWVudCA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCk7XHJcbiAgdmFsaWRhdGlvbkVsZW1lbnQuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVNb2RhbEVkaXQoKSB7XHJcbiAgY29uc3QgbmV3VXNlciA9IHVzZXIuZ2V0VXNlckluZm8oKTtcclxuICBuYW1lSW5wdXQudmFsdWUgPSBuZXdVc2VyLm5hbWU7XHJcbiAgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IG5ld1VzZXIuYWJvdXQ7XHJcbiAgZWRpdEZvcm0ub3BlblBvcHVwKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZU1vZGFsQWRkKCkge1xyXG4gIGFkZEZvcm0ub3BlblBvcHVwKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZU1vZGFsQXZhdGFyKCkge1xyXG4gIGF2YXRhckZvcm0ub3BlblBvcHVwKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVkaXRGb3JtU3VibWl0KCkge1xyXG4gIGNvbnN0IG5ld05hbWUgPSBuYW1lSW5wdXQudmFsdWU7XHJcbiAgY29uc3QgbmV3RGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbklucHV0LnZhbHVlO1xyXG4gIGNvbnN0IG5ld1VzZXJJbmZvID0geyBuYW1lOiBuZXdOYW1lLCBhYm91dDogbmV3RGVzY3JpcHRpb24gfTtcclxuICBlZGl0Rm9ybS5zZXRMb2FkaW5nVGV4dCh0cnVlKTtcclxuICBhcGkudXBkYXRlVXNlckluZm8obmV3VXNlckluZm8pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICB1c2VyLnNldFVzZXJJbmZvKHJlcyk7XHJcbiAgICAgIGVkaXRGb3JtLmNsb3NlUG9wdXAoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGVkaXRGb3JtLnNldExvYWRpbmdUZXh0KGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICBcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQWRkRm9ybVN1Ym1pdCgpIHtcclxuICBjb25zdCBjYXJkRGF0YSA9IHtcclxuICAgIG5hbWU6IHRpdGxlSW5wdXQudmFsdWUsXHJcbiAgICBsaW5rOiBsaW5rSW5wdXQudmFsdWUsXHJcbiAgfTtcclxuICBhZGRGb3JtLnNldExvYWRpbmdUZXh0KHRydWUpO1xyXG4gIGFwaS5hZGROZXdDYXJkKGNhcmREYXRhKVxyXG4gICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgcmVuZGVyQ2FyZChyZXMpO1xyXG4gICAgICBhZGRGb3JtLmNsb3NlUG9wdXAoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGFkZEZvcm0uc2V0TG9hZGluZ1RleHQoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgXHJcbiAgXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoKSB7XHJcbiAgY29uc3QgYXZhdGFySW5mbyA9IHthdmF0YXI6IGF2YXRhcklucHV0LnZhbHVlfTtcclxuICBcclxuICBhdmF0YXJGb3JtLnNldExvYWRpbmdUZXh0KHRydWUpO1xyXG4gIGFwaS51cGRhdGVQcm9maWxlUGljdHVyZShhdmF0YXJJbmZvKVxyXG4gICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgdXNlci5zZXRVc2VyQXZhdGFyKHJlcy5hdmF0YXIpO1xyXG4gICAgICBhdmF0YXJGb3JtLmNsb3NlUG9wdXAoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGF2YXRhckZvcm0uc2V0TG9hZGluZ1RleHQoZmFsc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gIFxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVGb3JtU3VibWl0KCkge1xyXG4gIGFwaS5kZWxldGVDYXJkKGNhcmQuZ2V0SWQoKSlcclxuICAudGhlbigoKSA9PiB7XHJcbiAgICBjYXJkLmRlbGV0ZUNhcmQoKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcblxyXG4gIGRlbGV0ZUZvcm0uY2xvc2VQb3B1cCgpO1xyXG59XHJcblxyXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVNb2RhbEVkaXQpO1xyXG5hZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU1vZGFsQWRkKTtcclxuYXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVNb2RhbEF2YXRhcik7XHJcblxyXG5cclxuZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICBhZGRWYWxpZGF0aW9uKHNldHRpbmdzLCBmb3JtRWxlbWVudCk7XHJcbn0pO1xyXG5cclxuXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBkZXNjcmlwdGlvblNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciB9KSB7XHJcbiAgICAgIHRoaXMuX25hbWVDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgIHRoaXMuX2Rlc2NyaXB0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihkZXNjcmlwdGlvblNlbGVjdG9yKTtcclxuICAgICAgdGhpcy5fYXZhdGFyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBuYW1lOiB0aGlzLl9uYW1lQ29udGFpbmVyLnRleHRDb250ZW50LFxyXG4gICAgICAgIGFib3V0OiB0aGlzLl9kZXNjcmlwdGlvbkNvbnRhaW5lci50ZXh0Q29udGVudCxcclxuICAgICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckNvbnRhaW5lci5zcmNcclxuICAgICAgfTtcclxuICAgIH1cclxuICBcclxuICAgIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgICB0aGlzLl9uYW1lQ29udGFpbmVyLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgICAgdGhpcy5fZGVzY3JpcHRpb25Db250YWluZXIudGV4dENvbnRlbnQgPSBhYm91dDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VyQXZhdGFyKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fYXZhdGFyQ29udGFpbmVyLnNyYztcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VyQXZhdGFyKGF2YXRhcikge1xyXG4gICAgICB0aGlzLl9hdmF0YXJDb250YWluZXIuc3JjID0gYXZhdGFyO1xyXG4gICAgfVxyXG4gIH0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmw7XHJcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlUmVzcG9uc2UocmVzKSB7XHJcbiAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7aGVhZGVyczogdGhpcy5faGVhZGVyc30pXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcclxuICAgIH0gXHJcblxyXG4gICAgZ2V0VXNlckRhdGEoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge2hlYWRlcnM6IHRoaXMuX2hlYWRlcnN9KVxyXG4gICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVVc2VySW5mbyh1c2VyT2JqKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKFxyXG4gICAgICAgICAgICBgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLCBcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsIFxyXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodXNlck9iailcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgICAudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUHJvZmlsZVBpY3R1cmUoaW5mbykge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChcclxuICAgICAgICAgICAgYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsIFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycywgXHJcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShpbmZvKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgYWRkTmV3Q2FyZChjYXJkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKFxyXG4gICAgICAgICAgICBgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsIFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBjYXJkLm5hbWUsIFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGNhcmQubGlua1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgICAudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goXHJcbiAgICAgICAgICAgIGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIiwgXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICAgLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChcclxuICAgICAgICAgICAgYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBVVFwiLCBcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgICAudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5saWtlQ2FyZChjYXJkSWQpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goXHJcbiAgICAgICAgICAgIGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIiwgXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICAgLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IocG9wdXBFbGVtZW50KSB7XHJcbiAgICAgICAgc3VwZXIocG9wdXBFbGVtZW50KTtcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uVGV4dENvbnRhaW5lciA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fc2F2ZVwiKTtcclxuICAgICAgICB0aGlzLl9kZWZhdWx0QnV0dG9uVGV4dCA9IHRoaXMuX2J1dHRvblRleHRDb250YWluZXIudGV4dENvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TG9hZGluZ1RleHQoaXNMb2FkaW5nKSB7XHJcbiAgICAgICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25UZXh0Q29udGFpbmVyLnRleHRDb250ZW50ID0gXCJEZWxldGluZy4uLlwiOyBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25UZXh0Q29udGFpbmVyLnRleHRDb250ZW50ID0gdGhpcy5fZGVmYXVsdEJ1dHRvblRleHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9wZW5Qb3B1cChoYW5kbGVGb3JtU3VibWl0KSB7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgc3VwZXIub3BlblBvcHVwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBFbGVtZW50KSB7XHJcbiAgICBzdXBlcihwb3B1cEVsZW1lbnQpO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5tb2RhbF9fcGljdHVyZS1pbWFnZVwiXHJcbiAgICApO1xyXG4gICAgdGhpcy5fcG9wdXBUZXh0ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3BpY3R1cmUtdGV4dFwiKTtcclxuICB9XHJcblxyXG4gIG9wZW5Qb3B1cChjYXJkKSB7XHJcbiAgICB0aGlzLl9wb3B1cEltYWdlLnNyYyA9IGNhcmQubGluaztcclxuICAgIHRoaXMuX3BvcHVwSW1hZ2UuYWx0ID0gY2FyZC5uYW1lO1xyXG4gICAgdGhpcy5fcG9wdXBUZXh0LnRleHRDb250ZW50ID0gY2FyZC5uYW1lO1xyXG4gICAgc3VwZXIub3BlblBvcHVwKCk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJ0ZW1wbGF0ZVNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlQ2FyZERlbGV0ZSIsImhhbmRsZUNhcmRMaWtlIiwiY3VycmVudFVzZXJJZCIsInRoaXMiLCJuYW1lIiwibGluayIsIl9saWtlcyIsImxpa2VzIiwiX2lkIiwiX293bmVyIiwib3duZXIiLCJfY3VycmVudFVzZXJJZCIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlQ2FyZExpa2UiLCJfaGFuZGxlQ2FyZERlbGV0ZSIsImdldElkIiwiX3NldE1hcmt1cCIsIl9jYXJkSW1hZ2UiLCJfY2FyZEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJfcmVuZGVyTGlrZXMiLCJfbGlrZUNvdW50IiwibGVuZ3RoIiwiaXNMaWtlZEJ5VXNlciIsIl9saWtlQnV0dG9uIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwic2V0TGlrZXMiLCJfZ2V0VGVtcGxhdGVDbG9uZSIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsInNvbWUiLCJsaWtlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9kZWxldGVCdXR0b24iLCJkZWxldGVDYXJkIiwiZ2VuZXJhdGVDYXJkIiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJfc2V0dGluZ3MiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJfYnV0dG9uRWxlbWVudCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsInJlc2V0VmFsaWRhdGlvbiIsImZvckVhY2giLCJpbnB1dEVsZW1lbnQiLCJfdG9nZ2xlSW5wdXRFcnJvciIsIl90b2dnbGVCdXR0b25TdGF0ZSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsImlkIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfZW5hYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2Rpc2FibGVCdXR0b24iLCJQb3B1cCIsInBvcHVwRWxlbWVudCIsImV2dCIsImtleSIsImNsb3NlUG9wdXAiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiX3BvcHVwRWxlbWVudCIsIl9wb3B1cEV4aXQiLCJvcGVuUG9wdXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlQ2xpY2tDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9idXR0b25UZXh0Q29udGFpbmVyIiwiX2RlZmF1bHRCdXR0b25UZXh0Iiwic2V0TG9hZGluZ1RleHQiLCJpc0xvYWRpbmciLCJfZ2V0SW5wdXRWYWx1ZXMiLCJmb3JtVmFsdWVzIiwiaW5wdXQiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsIm5hbWVJbnB1dCIsImRlc2NyaXB0aW9uSW5wdXQiLCJ0aXRsZUlucHV0IiwibGlua0lucHV0IiwiYWRkQ2FyZFdpbmRvdyIsImVkaXRCdXR0b24iLCJhZGRCdXR0b24iLCJlZGl0V2luZG93IiwiYWRkRm9ybUVsZW1lbnQiLCJhdmF0YXJXaW5kb3ciLCJhdmF0YXJJbnB1dCIsImF2YXRhckJ1dHRvbiIsInBpY3R1cmVXaW5kb3ciLCJkZWxldGVXaW5kb3ciLCJmb3JtU2VsZWN0b3IiLCJmb3JtTGlzdCIsInVzZXIiLCJuYW1lU2VsZWN0b3IiLCJkZXNjcmlwdGlvblNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUNvbnRhaW5lciIsIl9kZXNjcmlwdGlvbkNvbnRhaW5lciIsIl9hdmF0YXJDb250YWluZXIiLCJnZXRVc2VySW5mbyIsImFib3V0IiwiYXZhdGFyIiwic2V0VXNlckluZm8iLCJnZXRVc2VyQXZhdGFyIiwic2V0VXNlckF2YXRhciIsImFwaSIsIm9wdGlvbnMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJfaGFuZGxlUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0VXNlckRhdGEiLCJ1cGRhdGVVc2VySW5mbyIsInVzZXJPYmoiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZVByb2ZpbGVQaWN0dXJlIiwiaW5mbyIsImFkZE5ld0NhcmQiLCJjYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJ1bmxpa2VDYXJkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRTZWN0aW9uIiwiYWxsIiwidXNlckluZm9SZXMiLCJjYXJkUmVzIiwicmVuZGVyQ2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNhcmRJdGVtIiwiZGVsZXRlRm9ybSIsImZpbmFsbHkiLCJjYXJkRWxlbWVudCIsImFkZEZvcm0iLCJjYXJkRGF0YSIsImVkaXRGb3JtIiwibmV3VXNlckluZm8iLCJhdmF0YXJGb3JtIiwiYXZhdGFySW5mbyIsImltYWdlUG9wdXAiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cFRleHQiLCJuZXdVc2VyIiwiYWRkVmFsaWRhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=